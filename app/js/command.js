(function(){var getWall;getWall=angular.module("getWall",["ngAnimate"]),getWall.controller("getWallCtrl",function($scope,$http,$sce){return $scope.sce=$sce,$scope.id,$scope.count=0,$scope.getCount=0,$scope.list=[],$scope.check=!0,$scope.unknownError=function(){return $scope.show("Что-то пошло не так...","danger")},$scope.closeGet=function(){return $(".loading").remove(),$scope.check=!0},$scope.loadMore=function(){return console.log("work"),$(".more").remove(),$scope.check=!0,$scope.addPosts()},$scope.checkHeight=function(){return setTimeout(function(){if($scope.count>$scope.getCount&&$(document).height()<=$(window).height())return $scope.check=!1,$(".container").append('<div class="text-center more"><button class="btn btn-primary">Еще</button></div>'),$(".more").click(function(){return angular.element(maint).scope().loadMore()})},1e3)},$scope.show=function(text,classes){return document.getElementById("alert")||$('<aside role="alert" class="alert alert-'+classes+'" id="alert"><strong>'+text+"</strong></aside>").insertBefore("#main"),null},$scope.hide=function(){return document.getElementById("alert")&&$("#alert").remove(),null},$scope.get=function(){var count,id;return id=$("#id").val(),count=$("#count").val(),$scope.hide(),isNaN(id)||!id||id<1?void $scope.show("Введите числовой id","danger"):isNaN(count)||!count||id<1?void $scope.show("Введите сколько записей вы хотите получить","danger"):($scope.id=parseInt(id),$scope.count=parseInt(count),count>10&&(count=10),$http.get("http://localhost:8080?id="+id+"&count="+count).success(function(data){return data.response.error?data.response.user?$scope.show("Данный пользователь закрыл доступ к своей стене!","warning"):$scope.unknownError():($scope.getCount=parseInt(count),$scope.list=data.response.items,$scope.name=data.response.first_name+" "+data.response.last_name,$scope.show($scope.print(),"success"),$scope.checkHeight())}).error(function(){return $scope.unknownError()}))},$scope.print=function(){var end,post,reply;return end="о",post="ей",$scope.count%10===1&&$scope.count%100!==11?(end="a",post="ь"):$scope.count%10!==2&&$scope.count%10!==3&&$scope.count%10!==4||$scope.count%100===12||$scope.count%100===13||$scope.count%100===14||(post="и"),reply="Успешно получен"+end+" "+$scope.count+" запис"+post+" от пользователя "+$scope.name},$scope.addPosts=function(){var count;if($scope.check&&$scope.count>$scope.getCount&&$scope.id)return $scope.check=!1,$(".container").append('<div class="text-center loading"><i class="fa fa-spinner fa-pulse fa-3x"></i></div>'),count=$scope.count-$scope.getCount,parseInt(count)>10&&(count=10),$http.get("http://localhost:8080?id="+$scope.id+"&count="+count+"&offset="+$scope.getCount).success(function(data){var i,item,len,ref;if($scope.getCount+=parseInt(count),data.response.items)for(ref=data.response.items,i=0,len=ref.length;i<len;i++)item=ref[i],$scope.list.push(item),$scope.checkHeight();else $scope.unknownError();return $scope.closeGet()}).error(function(){return $scope.unknownError(),$scope.closeGet()})}}),getWall.directive("attachment",function(){return{link:function(scope,element,attrs){var attach;return attach=JSON.parse(attrs.attachment),console.log(attach.type),"link"===attach.type&&element.append('<div><p><a href="'+attach.link.url+'">'+attach.link.title+"</a></p><p>"+attach.link.description+"</p></div>"),"photo"===attach.type&&element.append('<img src="'+attach.photo.photo_604+'" width="350" height="350">'),"video"===attach.type&&element.append("<p>"+attach.video.title+'</p><p><img src="'+attach.video.photo_320+'"><p>'),null}}}),$(window).scroll(function(){var current,windowHeight;if(windowHeight=$(document).height()-$(window).height(),current=$(document).scrollTop(),current>$(window).height()&&$(".to-top").css({display:"block"}),current<$(window).height()&&$(".to-top").css({display:"none"}),windowHeight===current)return angular.element(maint).scope().addPosts()}),$(".to-top").click(function(){return $(document).scrollTop(0)})}).call(this);